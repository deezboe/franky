<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IndexedDB Explorer</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css" rel="stylesheet">
    <style>
        /* Previous CSS styles remain the same */
        /* Add upload button styles */
        .upload-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 16px;
        }
        
        .upload-btn:hover {
            background-color: var(--primary-dark);
        }
        
        .upload-container {
            margin-top: 16px;
            border: 1px dashed #e0e0e0;
            border-radius: 4px;
            padding: 16px;
            text-align: center;
        }
        
        .upload-input {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Previous HTML structure remains the same -->
    <!-- Add hidden file input -->
    <input type="file" id="file-upload" class="upload-input" multiple>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Previous state and DOM elements remain the same
            // Add file upload element
            const fileUpload = document.getElementById('file-upload');

            // Add event listener for file upload
            fileUpload.addEventListener('change', handleFileUpload);

            // Add the handleFileUpload function
            function handleFileUpload(event) {
                const files = event.target.files;
                if (!files || files.length === 0) return;
                
                updateStatus(`Uploading ${files.length} file(s) to ${state.currentStore}`);
                
                const request = indexedDB.open(state.currentDb);
                
                request.onsuccess = (event) => {
                    const db = event.target.result;
                    const transaction = db.transaction(state.currentStore, 'readwrite');
                    const store = transaction.objectStore(state.currentStore);
                    
                    let filesProcessed = 0;
                    
                    Array.from(files).forEach(file => {
                        const reader = new FileReader();
                        
                        reader.onload = (e) => {
                            // Use the filename as the key
                            const putRequest = store.put(file, file.name);
                            
                            putRequest.onsuccess = () => {
                                filesProcessed++;
                                if (filesProcessed === files.length) {
                                    updateStatus(`Successfully uploaded ${files.length} file(s)`);
                                    // Refresh the current view
                                    if (state.currentStore.includes('/')) {
                                        openPathAsFolder(state.currentStore.split('/').slice(0, -1).join('/'));
                                    } else {
                                        openObjectStore(state.currentStore);
                                    }
                                }
                            };
                            
                            putRequest.onerror = (event) => {
                                updateStatus(`Error uploading file ${file.name}: ${event.target.error}`, true);
                                console.error('Error uploading file:', event.target.error);
                            };
                        };
                        
                        reader.readAsArrayBuffer(file);
                    });
                    
                    transaction.oncomplete = () => {
                        db.close();
                    };
                };
                
                request.onerror = (event) => {
                    updateStatus(`Error opening database: ${event.target.error}`, true);
                    console.error('Error opening database:', event.target.error);
                };
                
                // Reset the file input
                event.target.value = '';
            }

            // Modify the renderStoreItems function to include upload button
            function renderStoreItems(items) {
                mainContent.innerHTML = '';
                
                if (items.length === 0) {
                    mainContent.innerHTML = `
                        <div class="empty-state">
                            <span class="material-icons empty-icon">info</span>
                            <div>No items found in this object store</div>
                        </div>
                        <div class="upload-container">
                            <button class="upload-btn" id="upload-files-btn">
                                <span class="material-icons">upload</span>
                                Upload Files
                            </button>
                        </div>
                    `;
                    
                    // Add event listener for upload button
                    document.getElementById('upload-files-btn').addEventListener('click', () => {
                        fileUpload.click();
                    });
                    return;
                }
                
                const header = document.createElement('div');
                header.className = 'content-header';
                header.innerHTML = `
                    <div class="content-title">Items in ${state.currentStore}</div>
                    <div class="content-actions">
                        <button class="action-btn" id="upload-files-btn">
                            <span class="material-icons">upload</span>
                            Upload Files
                        </button>
                        <button class="action-btn delete" id="delete-store-btn">
                            <span class="material-icons">delete</span>
                            Delete Store
                        </button>
                    </div>
                `;
                mainContent.appendChild(header);
                
                // Add event listeners for buttons
                document.getElementById('upload-files-btn').addEventListener('click', () => {
                    fileUpload.click();
                });
                
                document.getElementById('delete-store-btn').addEventListener('click', deleteCurrentStore);
                
                // Rest of the renderStoreItems function remains the same
                // ...
            }

            // Previous functions remain the same
            // ...
        });
    </script>
</body>
</html>
