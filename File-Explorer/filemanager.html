<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IndexedDB File Manager</title>
    <link rel="apple-touch-icon" sizes="256x256" href="icon.png">
    <link rel="icon" type="x-icon" href="icon.png">
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            background: white;
            color: black;
            font-family: arial;
            margin: 0;
            padding: none;
            overflow: hidden;
            -webkit-user-select: none;
        }
        .file_select {
            text-align: center;
            font-size: 0.9em;
        }
        /* New store selector styles */
        .store-selector-container {
            margin-right: 15px;
            position: relative;
        }
        .store-selector {
            padding: 6px 24px 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 14px;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23424242'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 12px;
        }
    </style>
    <!-- [Keep all your existing CSS styles] -->
    <script src="browserfs.min.js"></script>
    <script src="storeManager.js"></script> <!-- New store manager -->
</head>
<body>
    <div id="root">
        <div class="App">
            <div style="height: 480px;">
                <div data-test-id="filemanager" class="oc-fm--file-manager">
                    <div class="oc-fm--file-manager__navigators">
                        <div class="oc-fm--file-manager__navigator">
                            <div id="filemanager-1" data-test-id="filenavigator" class="oc-fm--file-navigator">
                                <div class="oc-fm--file-navigator__toolbar">
                                    <div class="oc-fm--toolbar">
                                        <!-- Added store selector -->
                                        <div class="store-selector-container">
                                            <select id="storeSelector" class="store-selector" title="Select IndexedDB Store">
                                                <option value="file_sandbox">Default Store</option>
                                            </select>
                                        </div>
                                        
                                        <div class="oc-fm--toolbar__nav-buttons">
                                            <button type="button" disabled="" class="oc-fm--toolbar__item" title="Move back">
                                                <div class="oc-svg oc-fm--toolbar__item-icon" style="fill: rgb(66, 66, 66);">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path d="M30.83 32.67l-9.17-9.17 9.17-9.17L28 11.5l-12 12 12 12z"></path></svg>
                                                </div>
                                            </button>
                                            <button type="button" disabled="" class="oc-fm--toolbar__item" title="Move forward">
                                                <div class="oc-svg oc-fm--toolbar__item-icon" style="fill: rgb(66, 66, 66);">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path d="M17.17 32.92l9.17-9.17-9.17-9.17L20 11.75l12 12-12 12z"></path></svg>
                                                </div>
                                            </button>
                                        </div>
                                        <!-- [Rest of your existing toolbar code] -->
                                    </div>
                                </div>
                                <!-- [Rest of your existing file manager UI] -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="fileManagerRuntime.js"></script>
    <script src="react.js"></script>
    <script src="filemanager.js"></script>
    
    <script>
    // Enhanced initialization with store management
    document.addEventListener('DOMContentLoaded', async function() {
        // Initialize store manager
        await storeManager.detectStores();
        
        // Populate store selector
        const selector = document.getElementById('storeSelector');
        storeManager.stores.forEach(store => {
            const option = document.createElement('option');
            option.value = store;
            option.textContent = store;
            selector.appendChild(option);
        });
        
        // Set current store
        selector.value = storeManager.currentStore;
        
        // Handle store switching
        selector.addEventListener('change', async function() {
            try {
                await storeManager.switchStore(this.value);
                // Refresh UI - modify this based on your framework
                window.location.reload(); 
            } catch (error) {
                console.error('Store switch failed:', error);
            }
        });
        
        // Initialize BrowserFS with current store
        await storeManager.switchStore(storeManager.currentStore);
    });
    </script>
</body>
</html>
