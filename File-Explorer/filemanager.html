<!DOCTYPE html>
<html>
<head>
    <!-- [Keep all your existing CSS and meta tags] -->
    <style>
        /* Add this new style for the store selector */
        .store-selector {
            margin-right: 15px;
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="root">
        <!-- [Keep your existing app structure] -->
    </div>

    <!-- Updated scripts section -->
    <script src="fileManagerRuntime.js"></script>
    <script src="react.js"></script>
    <script>
        // ========== NEW INDEXEDDB ROOT ACCESS CODE ==========
        class IndexedDBRootManager {
            constructor() {
                this.knownStores = ['file_sandbox'];
                this.currentStore = 'file_sandbox';
            }

            async init() {
                await this.detectStores();
                await this.initBrowserFS();
                this.setupUI();
            }

            async detectStores() {
                if ('databases' in indexedDB) {
                    try {
                        const databases = await indexedDB.databases();
                        this.knownStores = databases.map(db => db.name);
                        localStorage.setItem('knownStores', JSON.stringify(this.knownStores));
                    } catch (e) {
                        console.warn("Couldn't list databases, using fallback");
                        this.knownStores = JSON.parse(localStorage.getItem('knownStores')) || ['file_sandbox'];
                    }
                }
                return this.knownStores;
            }

            async initBrowserFS(storeName = this.currentStore) {
                return new Promise((resolve) => {
                    BrowserFS.configure({
                        fs: "IndexedDB",
                        options: { storeName }
                    }, (err) => {
                        if (err) throw err;
                        window.fs = BrowserFS.BFSRequire('fs');
                        this.currentStore = storeName;
                        resolve();
                    });
                });
            }

            setupUI() {
                // Create store selector dropdown
                const toolbar = document.querySelector('.oc-fm--toolbar');
                const selector = document.createElement('select');
                selector.className = 'store-selector';
                
                this.knownStores.forEach(store => {
                    const option = document.createElement('option');
                    option.value = store;
                    option.textContent = store;
                    selector.appendChild(option);
                });

                selector.addEventListener('change', async (e) => {
                    await this.initBrowserFS(e.target.value);
                    // Add logic to refresh your file view here
                    console.log(`Switched to store: ${e.target.value}`);
                });

                toolbar.insertBefore(selector, toolbar.firstChild);
            }
        }

        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            const rootManager = new IndexedDBRootManager();
            await rootManager.init();
        });
        // ========== END OF NEW CODE ==========
    </script>
    <script src="filemanager.js"></script>
</body>
</html>
