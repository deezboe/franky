<!doctype html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Mari0</title>

  <style>
    body {
      font-family: arial;
      margin: 0;
      padding: none;
    }

    #canvas {
      padding-right: 0;
      display: none;
      border: 0px none;
    }
  </style>
</head>
<body>
  <center>
    <h1>Mari0</h1>
    <div>
      <canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas>
      <canvas id="loadingCanvas" oncontextmenu="event.preventDefault()" width="800" height="600"></canvas>
    </div>
    <p>By Stabyourself.net</p>
    <p><a href="http://stabyourself.net/mari0/">Original Download Page</a></p>
    <p><a href="https://github.com/radgeRayden/future-mari0">Updated Source Code for Love v0.10.0</a></p>
  </center>

  <script type='text/javascript'>
    window.addEventListener("keydown", function(e) {
      if ([32, 37, 38, 39, 40].includes(e.keyCode)) {
        e.preventDefault();
      }
    }, false);

    const loadingContext = document.getElementById('loadingCanvas').getContext('2d');

    function drawLoadingText(text) {
      const canvas = loadingContext.canvas;
      loadingContext.fillStyle = 'white';
      loadingContext.fillRect(0, 0, canvas.scrollWidth, canvas.scrollHeight);
      loadingContext.font = '2em arial';
      loadingContext.textAlign = 'center';
      loadingContext.fillStyle = 'black';
      loadingContext.fillText(text, canvas.scrollWidth / 2, canvas.scrollHeight / 2);
      loadingContext.fillText("Powered By Emscripten.", canvas.scrollWidth / 2, canvas.scrollHeight / 4);
      loadingContext.fillText("Powered By LÃ–VE.", canvas.scrollWidth / 2, canvas.scrollHeight / 4 * 3);
    }

    const Module = {
      arguments: ['./'],
      printErr: console.error.bind(console),
      canvas: (function() {
        const canvas = document.getElementById('canvas');
        canvas.addEventListener("webglcontextlost", function(e) {
          alert('WebGL context lost. You will need to reload the page.');
          e.preventDefault();
        }, false);
        return canvas;
      })(),
      
      // Correct memory file location
      locateFile: (path) => {
        if (path.endsWith('.mem')) {
          return './love.js.mem';
        }
        return path;
      },

      setStatus: function(text) {
        if (text) {
          drawLoadingText(text);
        } else if (Module.didSyncFS && Module.remainingDependencies === 0) {
          Module.callMain(Module.arguments);
          document.getElementById('loadingCanvas').style.display = 'none';
          document.getElementById('canvas').style.display = 'block';
        }
      },
      didSyncFS: false,
      totalDependencies: 0,
      remainingDependencies: 0,
      monitorRunDependencies: function(left) {
        this.remainingDependencies = left;
        this.totalDependencies = Math.max(this.totalDependencies, left);
        Module.setStatus(left ? `Preparing... (${this.totalDependencies - left}/${this.totalDependencies})` : 'All downloads complete.');
      }
    };

    Module.setStatus('Downloading...');
    window.onerror = function(event) {
      Module.setStatus('Exception thrown, see JavaScript console');
      Module.setStatus = function(text) {
        if (text) Module.printErr('[post-exception status] ' + text);
      };
    };
  </script>

  <script type="text/javascript" src="game.js"></script>
  <script async type="text/javascript" src="love.js"></script>
</body>
</html>
